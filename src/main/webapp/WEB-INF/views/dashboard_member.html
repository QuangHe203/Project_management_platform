<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý nhóm</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            padding: 20px;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #2c3e50;
            color: white;
            font-weight: bold;
            border-radius: 10px 10px 0 0 !important;
        }
        .kanban-col {
            min-height: 500px;
            background-color: #ecf0f1;
            border-radius: 5px;
            padding: 10px;
        }
        .kanban-card {
            background-color: white;
            border-radius: 5px;
            margin-bottom: 10px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .kanban-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.1);
        }
        .task-item {
            border-left: 4px solid #3498db;
            margin-bottom: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
        }
        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            border-bottom: 1px solid #eee;
        }
        .btn-primary {
            background-color: #2c3e50;
            border-color: #2c3e50;
        }
        .btn-primary:hover {
            background-color: #1a252f;
            border-color: #1a252f;
        }
        .status-todo {
            border-left-color: #e74c3c;
        }
        .status-inprogress {
            border-left-color: #f39c12;
        }
        .status-done {
            border-left-color: #2ecc71;
        }
    </style>
</head>
<body>
<div class="container-fluid">
    <h1 class="mb-4"><i class="fas fa-users-cog me-2"></i>Quản lý nhóm</h1>

    <div class="row">
        <!-- Phần Task cá nhân -->
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-tasks me-2"></i>Task của tôi
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Task được giao -->
                        <div class="col-md-6">
                            <h5>Task được giao</h5>
                            <div id="assignedTasks" class="mt-3">
                                <div class="task-item">
                                    <h6>Phát triển tính năng mới</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span><i class="far fa-calendar-alt me-1"></i>01/08/2023 - 15/08/2023</span>
                                        <span class="badge bg-warning">Chờ xử lý</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-success">Chấp nhận</button>
                                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#taskDetailModal">Xem chi tiết</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Task đang làm -->
                        <div class="col-md-6">
                            <h5>Task đang thực hiện</h5>
                            <div id="inProgressTasks" class="mt-3">
                                <div class="task-item">
                                    <h6>Cải thiện hiệu năng</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span><i class="far fa-calendar-alt me-1"></i>05/08/2023 - 20/08/2023</span>
                                        <span class="badge bg-info">Đang thực hiện</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-sm btn-success">Hoàn thành</button>
                                        <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#taskDetailModal">Xem chi tiết</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Kanban board -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-clipboard-list me-2"></i>Kanban Board
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <h5 class="text-center">Cần làm</h5>
                            <div class="kanban-col" id="todo">
                                <!-- Các task ở trạng thái "Cần làm" -->
                                <div class="kanban-card status-todo" draggable="true">
                                    <h6>Nhiệm vụ mẫu</h6>
                                    <p><small>Người thực hiện: Người dùng mẫu</small></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h5 class="text-center">Đang thực hiện</h5>
                            <div class="kanban-col" id="inprogress">
                                <!-- Các task ở trạng thái "Đang thực hiện" -->
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h5 class="text-center">Hoàn thành</h5>
                            <div class="kanban-col" id="done">
                                <!-- Các task ở trạng thái "Hoàn thành" -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal tạo tác vụ -->
<div class="modal fade" id="taskModal" tabindex="-1" aria-labelledby="taskModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="taskModalLabel">Tạo tác vụ mới</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="taskForm">
                    <div class="mb-3">
                        <label for="taskTitle" class="form-label">Tiêu đề</label>
                        <input type="text" class="form-control" id="taskTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="taskContent" class="form-label">Nội dung</label>
                        <textarea class="form-control" id="taskContent" rows="3" required></textarea>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="startDate" class="form-label">Ngày bắt đầu</label>
                            <input type="date" class="form-control" id="startDate" required>
                        </div>
                        <div class="col-md-6">
                            <label for="endDate" class="form-label">Ngày kết thúc</label>
                            <input type="date" class="form-control" id="endDate" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="assignee" class="form-label">Người thực hiện</label>
                        <select class="form-select" id="assignee" required>
                            <option value="" selected disabled>Chọn người thực hiện</option>
                            <option value="Nguyễn Văn A">Nguyễn Văn A</option>
                            <option value="Trần Thị B">Trần Thị B</option>
                            <option value="Lê Văn C">Lê Văn C</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="saveTask">Lưu tác vụ</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal thêm thành viên -->
<div class="modal fade" id="memberModal" tabindex="-1" aria-labelledby="memberModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="memberModalLabel">Thêm thành viên</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="memberForm">
                    <div class="mb-3">
                        <label for="memberName" class="form-label">Tên thành viên</label>
                        <input type="text" class="form-control" id="memberName" required>
                    </div>
                    <div class="mb-3">
                        <label for="memberEmail" class="form-label">Email (đã mã hóa)</label>
                        <input type="text" class="form-control" id="memberEmail" required readonly>
                    </div>
                    <div class="mb-3">
                        <button type="button" class="btn btn-sm btn-outline-secondary" id="encodeEmail">
                            <i class="fas fa-lock me-2"></i>Mã hóa email
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="saveMember">Thêm thành viên</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal xem chi tiết task -->
<div class="modal fade" id="taskDetailModal" tabindex="-1" aria-labelledby="taskDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="taskDetailModalLabel">Chi tiết task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h5>Tên task</h5>
                    <p>Phát triển tính năng mới</p>
                </div>
                <div class="mb-3">
                    <h5>Nội dung</h5>
                    <p>Xây dựng hệ thống đăng nhập bằng Google</p>
                </div>
                <div class="mb-3">
                    <h5>Thời gian</h5>
                    <p>01/08/2023 - 15/08/2023</p>
                </div>
                <div class="mb-3">
                    <h5>Trạng thái</h5>
                    <span class="badge bg-warning">Chờ xử lý</span>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS và các thư viện khác -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Biến lưu trữ dữ liệu
    let tasks = [
        {
            id: 1,
            title: "Phát triển tính năng mới",
            content: "Xây dựng hệ thống đăng nhập bằng Google",
            startDate: "2023-08-01",
            endDate: "2023-08-15",
            assignee: "Nguyễn Văn A",
            status: "todo"
        },
        {
            id: 2,
            title: "Cải thiện hiệu năng",
            content: "Tối ưu hóa truy vấn database",
            startDate: "2023-08-05",
            endDate: "2023-08-20",
            assignee: "Trần Thị B",
            status: "inprogress"
        },
        {
            id: 3,
            title: "Sửa lỗi giao diện",
            content: "Khắc phục lỗi hiển thị trên mobile",
            startDate: "2023-07-25",
            endDate: "2023-08-05",
            assignee: "Lê Văn C",
            status: "done"
        }
    ];
    let members = [
        { id: 1, name: "Nguyễn Văn A", email: "bm5ndXnDuG5WxINhQGV4YW1wbGUuY29t" },
        { id: 2, name: "Trần Thị B", email: "xJHh2FuVOGhpIELDmGV4YW1wbGUuY29t" },
        { id: 3, name: "Lê Văn C", email: "bMOqIFbEgW5DIGBleGFtcGxlLmNvbQ==" }
    ];

    // DOM Elements
    const taskForm = document.getElementById('taskForm');
    const memberForm = document.getElementById('memberForm');
    const taskList = document.getElementById('taskList');
    const memberList = document.getElementById('memberList');
    const todoCol = document.getElementById('todo');
    const inprogressCol = document.getElementById('inprogress');
    const doneCol = document.getElementById('done');

    // Thêm sự kiện cho các nút
    document.getElementById('saveTask').addEventListener('click', addTask);
    document.getElementById('saveMember').addEventListener('click', addMember);
    document.getElementById('encodeEmail').addEventListener('click', encodeEmail);

    // Render lại danh sách khi tải trang
    renderTaskList();
    renderMemberList();

    // Hàm thêm tác vụ mới
    function addTask() {
        const title = document.getElementById('taskTitle').value;
        const content = document.getElementById('taskContent').value;
        const startDate = document.getElementById('startDate').value;
        const endDate = document.getElementById('endDate').value;
        const assignee = document.getElementById('assignee').value;

        if (!title || !content || !startDate || !endDate || !assignee) {
            alert('Vui lòng điền đầy đủ thông tin!');
            return;
        }

        const newTask = {
            id: Date.now(),
            title,
            content,
            startDate,
            endDate,
            assignee,
            status: 'todo' // Mặc định là "Cần làm"
        };

        tasks.push(newTask);
        renderTaskList();
        renderKanban();

        // Đóng modal và reset form
        bootstrap.Modal.getInstance(document.getElementById('taskModal')).hide();
        taskForm.reset();
    }

    // Hàm thêm thành viên mới
    function addMember() {
        const name = document.getElementById('memberName').value;
        const email = document.getElementById('memberEmail').value;

        if (!name || !email) {
            alert('Vui lòng điền đầy đủ thông tin và mã hóa email!');
            return;
        }

        const newMember = {
            id: Date.now(),
            name,
            email
        };

        members.push(newMember);
        renderMemberList();

        // Đóng modal và reset form
        bootstrap.Modal.getInstance(document.getElementById('memberModal')).hide();
        memberForm.reset();
    }

    // Hàm mã hóa email (đơn giản)
    function encodeEmail() {
        const email = document.getElementById('memberName').value + '@example.com';
        if (!email) {
            alert('Vui lòng nhập tên thành viên trước!');
            return;
        }

        // Mã hóa đơn giản bằng Base64
        const encodedEmail = btoa(email);
        document.getElementById('memberEmail').value = encodedEmail;
    }

    // Hàm render danh sách tác vụ
    function renderTaskList() {
        taskList.innerHTML = '';

        if (tasks.length === 0) {
            taskList.innerHTML = '<p class="text-muted">Chưa có tác vụ nào được tạo.</p>';
            return;
        }

        tasks.forEach(task => {
            const taskItem = document.createElement('div');
            taskItem.className = 'task-item';
            taskItem.innerHTML = `
                    <h5>${task.title}</h5>
                    <p><small class="text-muted">Nội dung: ${task.content}</small></p>
                    <div class="d-flex justify-content-between">
                        <span><i class="far fa-calendar-alt me-1"></i>${task.startDate} - ${task.endDate}</span>
                        <span><i class="fas fa-user me-1"></i>${task.assignee}</span>
                    </div>
                `;
            taskList.appendChild(taskItem);
        });
    }

    // Hàm render danh sách thành viên
    function renderMemberList() {
        memberList.innerHTML = '';

        if (members.length === 0) {
            memberList.innerHTML = '<p class="text-muted">Chưa có thành viên nào trong nhóm.</p>';
            return;
        }

        members.forEach(member => {
            const memberItem = document.createElement('div');
            memberItem.className = 'member-item';
            memberItem.innerHTML = `
                    <span><i class="fas fa-user me-2"></i>${member.name}</span>
                    <button class="btn btn-sm btn-outline-danger" onclick="removeMember(${member.id})">
                        <i class="fas fa-times"></i>
                    </button>
                `;
            memberList.appendChild(memberItem);
        });
    }

    // Hàm render kanban board
    function renderKanban() {
        todoCol.innerHTML = '';
        inprogressCol.innerHTML = '';
        doneCol.innerHTML = '';

        tasks.forEach(task => {
            const kanbanCard = document.createElement('div');
            kanbanCard.className = `kanban-card status-${task.status}`;
            kanbanCard.draggable = true;
            kanbanCard.innerHTML = `
                    <h6>${task.title}</h6>
                    <p><small>Người thực hiện: ${task.assignee}</small></p>
                `;

            kanbanCard.addEventListener('dragstart', () => {
                kanbanCard.classList.add('dragging');
            });

            kanbanCard.addEventListener('dragend', () => {
                kanbanCard.classList.remove('dragging');
            });

            switch(task.status) {
                case 'todo':
                    todoCol.appendChild(kanbanCard);
                    break;
                case 'inprogress':
                    inprogressCol.appendChild(kanbanCard);
                    break;
                case 'done':
                    doneCol.appendChild(kanbanCard);
                    break;
            }
        });

        // Thêm sự kiện kéo thả cho các cột
        [todoCol, inprogressCol, doneCol].forEach(column => {
            column.addEventListener('dragover', e => {
                e.preventDefault();
                const draggingCard = document.querySelector('.dragging');
                if (draggingCard) {
                    const afterElement = getDragAfterElement(column, e.clientY);
                    if (afterElement) {
                        column.insertBefore(draggingCard, afterElement);
                    } else {
                        column.appendChild(draggingCard);
                    }
                }
            });

            column.addEventListener('drop', e => {
                e.preventDefault();
                const draggingCard = document.querySelector('.dragging');
                if (draggingCard) {
                    // Cập nhật trạng thái task dựa vào cột mà nó được thả vào
                    const taskId = parseInt(draggingCard.dataset.id);
                    const taskIndex = tasks.findIndex(t => t.id === taskId);

                    if (taskIndex !== -1) {
                        if (column.id === 'todo') {
                            tasks[taskIndex].status = 'todo';
                        } else if (column.id === 'inprogress') {
                            tasks[taskIndex].status = 'inprogress';
                        } else if (column.id === 'done') {
                            tasks[taskIndex].status = 'done';
                        }
                    }
                }
            });
        });
    }

    // Hàm hỗ trợ kéo thả
    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.kanban-card:not(.dragging)')];

        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;

            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

    // Hàm xóa thành viên
    function removeMember(id) {
        if (confirm('Bạn có chắc chắn muốn xóa thành viên này?')) {
            members = members.filter(member => member.id !== id);
            renderMemberList();
        }
    }
</script>
</body>
</html>
